<!-- rentals/templates/rentals/apartment_detail.html -->


{% block title %}{{ apartment.title }}{% endblock %}

{% block content %}
<div class="container">
    <h1>{{ apartment.title }}</h1>
    <div class="card">
        {% if images %}
            {% for image in images %}
                <img src="{{ image.image.url }}" alt="Image of {{ apartment.title }}">
            {% endfor %}
        {% else %}
            <p>No images available.</p>
        {% endif %}
        <div class="card-body">
            <p>{{ apartment.description }}</p>
            <p><strong>Price:</strong> ${{ apartment.price }}</p>
            <p><strong>Address:</strong> {{ apartment.address }}</p>
            <p><strong>Bedrooms:</strong> {{ apartment.bedrooms }}</p>
            <p><strong>Square Feet:</strong> {{ apartment.square_feet }}</p>
            <p><strong>Amenities:</strong></p>
            <ul>
                {% for amenity in apartment.amenities.all %}
                    <li>{{ amenity.name }}</li>
                {% endfor %}
            </ul>
            <a href="{% url 'apartment_list' %}" class="btn-primary">Back to Listings</a>
        </div>
    </div>
</div>
<div id="rating-section">
    <p>Average Rating: <span id="average-rating">
        {% if apartment.average_rating > 0 %}
            {{ apartment.average_rating|floatformat:2 }}
        {% else %}
            No ratings yet
        {% endif %}
    </span></p>
    <div id="rating-stars">
        {% for i in "12345" %}
            <span class="star" data-value="{{ i }}">&#9734;</span>
        {% endfor %}
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    console.log("Document ready");

    $('.star').on('click', function() {
        console.log("Star clicked");

        var rating = $(this).data('value');
        $.ajax({
            url: '{% url "rate_post" apartment.id %}',
            type: 'POST',
            data: {
                'rating': rating,
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function(response) {
                console.log("AJAX success", response);
                if (response.success) {
                    $('#average-rating').text(response.average_rating.toFixed(2));
                }
            },
            error: function(xhr, status, error) {
                console.error("AJAX error", status, error);
            }
        });
    });
});
</script>

<style>
.star {
    font-size: 24px;
    color: #ccc;
    cursor: pointer;
    user-select: none;
}
.star:hover,
.star.active {
    color: #ffcc00;
}
#debug-info {
    margin-top: 20px;
    padding: 10px;
    background-color: #f0f0f0;
    border: 1px solid #ccc;
}
</style>
{% endblock %}
